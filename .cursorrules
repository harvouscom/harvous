# Cursor Rules for Harvous Project

## Documentation Structure
- **README.md**: Project overview, setup, and quick start guide
- **ARCHITECTURE.md**: Core functionality, data structures, and implementation details
- **ALWAYS consult ARCHITECTURE.md** when working on:
  - Content organization (Spaces/Threads/Notes)
  - Note ID system and UserMetadata
  - Database schema and relationships
  - Navigation logic and color system
  - Thread deletion behavior
  - Alpine.js integration patterns
  - View Transitions handling
- **ALWAYS consult README.md** for:
  - Development server setup
  - Project overview and features
  - Quick reference links

## Development Server
- **ALWAYS use port 4321** for the development server
- If port 4321 is busy, kill the process using: `lsof -ti:4321 | xargs kill -9`
- Then restart with: `npm run dev`
- Never use other ports (4322, 4323, etc.) - always force port 4321

## Astro Development
- Always consult Astro MCP for component development, API usage, and best practices
- Use proper Alpine.js syntax with `x-data`, `x-on:click`, `x-show`, etc.
- NO inline `onclick` handlers - use Alpine.js directives instead

## Note ID System
- **CRITICAL**: Never reuse deleted note IDs - always increment from highest ever used
- Use UserMetadata table to track `highestSimpleNoteId` per user
- Next ID = `highestSimpleNoteId + 1` (never reuses deleted IDs)
- See ARCHITECTURE.md for complete implementation details

## Navigation System
- The persistent navigation system uses localStorage for history
- Navigation items should only appear once (no duplicates)
- Close icons should appear on hover and work properly
- Use `window.debugNavigation.clearHistory()` to clear navigation history for testing

## Code Quality
- Always test functionality before declaring it complete
- Check for linting errors after making changes
- Use proper TypeScript types and avoid `any` when possible
- Follow existing code patterns and architecture
- **Update documentation** when making architectural changes

## Critical Development Rules
- **NEVER undo or revert working functionality without fully understanding the issue**
- **ALWAYS ask for clarification if the user's problem description is unclear**
- **NEVER make assumptions about what the user wants - ask first**
- **If you don't understand a problem completely, ask questions before making changes**
- **When debugging, add logging/debugging first, don't immediately change working code**
- **Preserve existing functionality unless explicitly asked to change it**
