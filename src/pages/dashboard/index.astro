---
// import { actions } from "astro:actions";
import { db, eq, Notes } from "astro:db";
import Layout from "@/layouts/Layout.astro";
import NoteCard from "@/components/NoteCard.astro";
import CtaButton from "@/components/CtaButton.astro";
import Tab from "@/components/TabBar/Tab.astro";
import SearchInput from "@/components/SearchInput.astro";
import SquareButton from "@/components/SquareButton.astro";
import ActionButton from "@/components/ActionButton.astro";
import SelectColorButton from "@/components/SelectColorButton.astro";
import FaPaperclipIcon from "@fortawesome/fontawesome-free/svgs/solid/paperclip.svg";

if (!Astro.locals.auth().userId) {
  return Astro.redirect("/");
}

const user = await Astro.locals.currentUser();

if (!user) {
  return Astro.redirect("/");
}

const notes = await db.select().from(Notes).where(eq(Notes.userId, user.id));
---

<Layout>
  <section class="bg-(--color-fog-white) pt-3">
    <div class="px-6 mx-auto max-w-screen-sm flex items-center gap-2">
      <Tab label="Feed" href="#" active />
    </div>
  </section>

  <SquareButton variant="Close" />
  <SquareButton variant="Add" />
  <SquareButton variant="More" />
  <SquareButton variant="Back" />
  <ActionButton>
    <FaPaperclipIcon />
  </ActionButton>

  <main
    class="max-w-screen-sm mx-auto px-6 pt-6 pb-12 grid grid-rows-[auto_1fr] gap-3"
  >
    <SearchInput />
    <ul class="grid max-sm:grid-cols-2 sm:grid-cols-3 gap-3 gap-y-4">
      {
        notes.map((note) => (
          <li class="w-full h-full">
            <a class="h-full" href={`/dashboard/notes/${note.id}`}>
              <NoteCard title={note.title ?? ""} content={note.content ?? ""} />
            </a>
          </li>
        ))
      }
    </ul>

    <a href="/dashboard/notes/new">
      <CtaButton />
    </a>

    <button @click="$dispatch('toast', { message: 'Hello, world!', type: 'info' });">Show Toast</button>

    <!-- Color Picker Test Section -->
    <div class="mt-8 p-6 bg-white rounded-xl shadow-sm border border-gray-100">
      <h3 class="text-subtitle mb-4">Color Picker Test</h3>
      <div class="grid grid-cols-4 gap-3">
        <SelectColorButton color="Paper" />
        <SelectColorButton color="Blue" />
        <SelectColorButton color="Yellow" />
        <SelectColorButton color="Orange" />
        <SelectColorButton color="Green" />
        <SelectColorButton color="Pink" />
        <SelectColorButton color="Purple" />
      </div>
      
      <div class="mt-4">
        <h4 class="text-body mb-2">Form Test (Single Select)</h4>
        <form class="space-y-3">
          <div class="grid grid-cols-4 gap-3">
            <SelectColorButton name="selectedColor" color="Paper" value="paper" />
            <SelectColorButton name="selectedColor" color="Blue" value="blue" checked={true} />
            <SelectColorButton name="selectedColor" color="Yellow" value="yellow" />
            <SelectColorButton name="selectedColor" color="Green" value="green" />
          </div>
          <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
            Submit Color Choice
          </button>
        </form>
      </div>
    </div>
  </main>
</Layout>
