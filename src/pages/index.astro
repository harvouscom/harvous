---
import { SignedIn, SignedOut, SignInButton } from "@clerk/astro/components";
import Layout from '../layouts/Layout.astro';
import ThreadCard from '../components/ThreadCard.astro';

// Check if we should force sign-in based on URL parameter
const url = new URL(Astro.request.url);
const forceSignIn = url.searchParams.get('sign-in') === 'true';

// If already authenticated, redirect to dashboard
if (Astro.locals.auth().userId) {
  return Astro.redirect('/feed');
}

Astro.response.headers.set("Cache-Control", "public, max-age=0, must-revalidate");
Astro.response.headers.set("Netlify-CDN-Cache-Control", "public, durable, s-maxage=300, stale-while-revalidate=604800");
Astro.response.headers.set("Netlify-Cache-Tag", "landing");
---

<Layout title="Harvous Demo">
  <main class="bg-[#f2f0e6] min-h-screen">
    <div class="container mx-auto px-4 py-16">
      <div class="text-center mb-16">
        <h1 class="text-4xl font-bold mb-8 text-[#4A473D]">Welcome to your Harvous!</h1>
        <p class="text-lg text-[#666]">The home for your Bible study.</p>
      </div>
      
      <div class="text-center mt-16">
        <SignedIn>
          <a 
            href="/feed" 
            class="inline-block px-6 py-3 bg-[#4A473D] text-white rounded-lg font-medium hover:bg-[#5a574d] transition-colors"
          >
            Go to My Feed
          </a>
        </SignedIn>
        <SignedOut>
          <SignInButton mode="modal">
            <span class="inline-block px-6 py-3 bg-[#4A473D] text-white rounded-lg font-medium hover:bg-[#5a574d] transition-colors cursor-pointer">
              Sign In
            </span>
          </SignInButton>
          
          <div class="mt-4">
            <a href="/?sign-in=true" class="text-sm text-blue-600 hover:underline">
              Having trouble signing in? Click here
            </a>
          </div>
        </SignedOut>
      </div>
    </div>
  </main>
</Layout>

<style>
  :root {
    --color-paper: #f2f0e6;
  }
</style>
