---
import EmptyLayout from "@/layouts/EmptyLayout.astro";
import { SignIn as ClerkSignIn } from "@clerk/astro/components";
import SquareButton from "@/components/SquareButton.astro";
---

<EmptyLayout title="Sign In">
  <div class="min-h-[100svh] max-h-[100svh] p-3 flex flex-col">
    <div class="flex-1 flex flex-col lg:flex-row gap-6">
      <!-- Top Row (Mobile) / Left Column (Desktop): Thread Colors Mesh Gradient -->
      <div class="flex flex-1 thread-colors-mesh-gradient relative overflow-hidden rounded-[12px]">
        <div class="relative z-10 flex flex-col p-3 w-full h-full">
          <!-- Back to home link using SquareButton Back variant -->
          <a href="https://harvous.com" class="block w-fit">
            <SquareButton variant="Back" />
          </a>
        </div>
      </div>

      <!-- Bottom Row (Mobile) / Right Column (Desktop): Sign In Form -->
      <div class="flex-1 flex items-center justify-center bg-[var(--color-light-paper)] min-h-0 p-3">
        <div class="w-full max-w-md mx-auto">

      <ClerkSignIn
        appearance={{
            elements: {
                rootBox: "w-full flex justify-center",
                card: {
                  className: "bg-white rounded-2xl shadow-lg p-8 w-full max-w-md",
                  style: {
                    border: "none",
                    borderWidth: "0"
                  }
                },
            headerTitle: "text-2xl font-bold text-[var(--color-deep-grey)]",
            headerSubtitle: "text-[var(--color-stone-grey)]",
            formField: "",
            formButtonPrimary: "group relative rounded-3xl cursor-pointer transition-[scale,shadow] duration-300 pb-7 pt-6 px-6 flex items-center justify-center font-sans font-semibold text-[18px] leading-[0] text-nowrap text-[var(--color-fog-white)] min-h-[60px] w-full primary-button",
            formFieldInput: "rounded-3xl py-5 px-4 min-h-[64px] bg-transparent border-none text-[18px] font-semibold text-[var(--color-deep-grey)] text-center placeholder:text-[var(--color-pebble-grey)] focus:outline-none focus:ring-0",
            formFieldLabel: "hidden",
            formFieldError: {
              className: "mt-2 text-center",
              style: {
                position: "static",
                display: "block",
                marginTop: "8px",
                color: "#ef4444",
                fontSize: "14px"
              }
            },
            footerActionLink: "text-[var(--color-bold-blue)] hover:text-[var(--color-bold-blue)]/80 font-medium",
            dividerLine: "bg-gray-200",
            dividerText: "text-[var(--color-stone-grey)] bg-white px-4"
          },
          variables: {
            colorPrimary: "var(--color-bold-blue)"
          }
        }}
        signUpUrl="/sign-up"
        redirectUrl="/"
      />
        </div>
      </div>
    </div>
  </div>
</EmptyLayout>

<style>
  /* PRIMARY BUTTON STYLING - Match Button.astro component */
  /* Target all Clerk primary buttons including modals, error screens, etc. */
  .primary-button,
  :global(.cl-formButtonPrimary),
  :global(.cl-buttonPrimary),
  :global([class*="cl-buttonPrimary"]),
  :global([class*="cl-formButtonPrimary"]),
  :global(button[type="submit"][class*="cl-"]),
  :global(.cl-card button[type="submit"]),
  :global(.cl-modalContent button[type="submit"]),
  :global(.cl-alert button[type="submit"]) {
    background-color: var(--color-bold-blue) !important;
    will-change: transform, box-shadow !important;
    transition:
      background-color 0.125s ease-in-out,
      box-shadow 0.125s ease-in-out !important;
    box-shadow:
      0px -8px 0px 0px hsla(0, 0%, 0%, 0.1) inset,
      0px 4px 4px 0px hsla(0, 0%, 0%, 0.25) !important;
    border-radius: 1.5rem !important;
    min-height: 60px !important;
    font-weight: 600 !important;
    font-size: 18px !important;
    color: var(--color-fog-white) !important;
  }

  .primary-button:hover,
  :global(.cl-formButtonPrimary:hover),
  :global(.cl-buttonPrimary:hover),
  :global([class*="cl-buttonPrimary"]:hover),
  :global([class*="cl-formButtonPrimary"]:hover),
  :global(button[type="submit"][class*="cl-"]:hover),
  :global(.cl-card button[type="submit"]:hover),
  :global(.cl-modalContent button[type="submit"]:hover),
  :global(.cl-alert button[type="submit"]:hover) {
    background-color: var(--color-bold-blue) !important;
  }

  .primary-button:active,
  :global(.cl-formButtonPrimary:active),
  :global(.cl-buttonPrimary:active),
  :global([class*="cl-buttonPrimary"]:active),
  :global([class*="cl-formButtonPrimary"]:active),
  :global(button[type="submit"][class*="cl-"]:active),
  :global(.cl-card button[type="submit"]:active),
  :global(.cl-modalContent button[type="submit"]:active),
  :global(.cl-alert button[type="submit"]:active) {
    transform: scale(0.98) !important;
    background-color: var(--color-navy) !important;
    box-shadow:
      0px -4px 0px 0px #0000001a inset,
      0px 0px 4px 0px #00000040,
      0px 4px 0px 0px #00000040 inset !important;
  }

  .primary-button:active > *,
  :global(.cl-formButtonPrimary:active > *),
  :global(.cl-buttonPrimary:active > *),
  :global([class*="cl-buttonPrimary"]:active > *),
  :global([class*="cl-formButtonPrimary"]:active > *),
  :global(button[type="submit"][class*="cl-"]:active > *),
  :global(.cl-card button[type="submit"]:active > *),
  :global(.cl-modalContent button[type="submit"]:active > *),
  :global(.cl-alert button[type="submit"]:active > *) {
    translate: 0 0 !important;
    transform: scale(0.98) !important;
  }

  /* HIDE ARROW ICON - Comprehensive targeting of all Clerk button icons */
  .primary-button svg,
  .primary-button img,
  .primary-button [class*="icon"],
  .primary-button [class*="arrow"],
  .primary-button [class*="Icon"],
  .primary-button [class*="Arrow"],
  .primary-button::after,
  .primary-button::before,
  .primary-button *::after,
  .primary-button *::before,
  :global(.cl-formButtonPrimary svg),
  :global(.cl-formButtonPrimary img),
  :global(.cl-formButtonPrimary [class*="icon"]),
  :global(.cl-formButtonPrimary [class*="arrow"]),
  :global(.cl-formButtonPrimary [class*="Icon"]),
  :global(.cl-formButtonPrimary [class*="Arrow"]),
  :global(.cl-formButtonPrimary::after),
  :global(.cl-formButtonPrimary::before),
  :global(.cl-formButtonPrimary *::after),
  :global(.cl-formButtonPrimary *::before),
  :global(.cl-buttonIcon),
  :global(.cl-signInButtonIcon),
  :global(.cl-signUpButtonIcon),
  :global([class*="cl-buttonIcon"]),
  :global([class*="cl-icon"]),
  :global([class*="buttonIcon"]),
  :global([class*="ButtonIcon"]),
  :global(.cl-card button[type="submit"] svg),
  :global(.cl-modalContent button[type="submit"] svg),
  :global(.cl-alert button[type="submit"] svg) {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    width: 0 !important;
    height: 0 !important;
    content: none !important;
    font-size: 0 !important;
    line-height: 0 !important;
  }

  /* Hide any child elements that aren't the main text */
  .primary-button > *:nth-child(n+2),
  :global(.cl-formButtonPrimary > *:nth-child(n+2)) {
    display: none !important;
    visibility: hidden !important;
  }

  /* Hide sibling elements after first child */
  .primary-button span + *,
  .primary-button div + *,
  :global(.cl-formButtonPrimary span + *),
  :global(.cl-formButtonPrimary div + *) {
    display: none !important;
  }

  /* Ensure button text is centered */
  .primary-button,
  :global(.cl-formButtonPrimary),
  :global(.cl-buttonPrimary),
  :global([class*="cl-buttonPrimary"]),
  :global([class*="cl-formButtonPrimary"]),
  :global(button[type="submit"][class*="cl-"]),
  :global(.cl-card button[type="submit"]),
  :global(.cl-modalContent button[type="submit"]),
  :global(.cl-alert button[type="submit"]) {
    justify-content: center !important;
  }

  /* Remove border from card */
  :global(.cl-card),
  :global([data-clerk-element="card"]),
  :global([class*="cl-card"]) {
    border: none !important;
    border-width: 0 !important;
    outline: none !important;
  }

  /* Style ONLY input fields to match app's search-input style */
  /* Be specific - only target actual input elements, not containers */
  :global(.cl-formField input[type="email"]),
  :global(.cl-formField input[type="password"]),
  :global(.cl-formField input[type="text"]),
  :global([data-clerk-element="formFieldInput"][type="email"]),
  :global([data-clerk-element="formFieldInput"][type="password"]),
  :global([data-clerk-element="formFieldInput"][type="text"]) {
    background: var(--color-gradient-gray) !important;
    box-shadow: var(--shadow-small) !important;
    position: relative !important; /* Ensure input itself doesn't create positioning context */
    z-index: 0 !important; /* Keep input below other elements */
  }

  /* Ensure input wrapper doesn't interfere with link positioning */
  :global(.cl-formFieldInputWrapper),
  :global([data-clerk-element="formFieldInputWrapper"]),
  :global(.cl-formField > div:has(input)) {
    position: relative !important;
    z-index: 0 !important;
  }

  /* Ensure form fields maintain proper structure for error positioning */
  /* Only affect form fields that contain inputs, preserve other structure */
  /* Remove mb-3 margin-bottom that was adding extra spacing */
  :global(.cl-formField:has(input[type="email"])),
  :global(.cl-formField:has(input[type="password"])),
  :global(.cl-formField:has(input[type="text"])),
  :global([data-clerk-element="formField"]:has(input)),
  :global(.cl-formField.mb-3) {
    display: flex !important;
    flex-direction: column !important;
    position: relative !important;
    margin-bottom: 0 !important; /* Remove mb-3 margin */
  }

  /* Override Clerk's default 32px gap on the form to use 12px instead */
  :global(.cl-form),
  :global([data-clerk-element="form"]),
  :global([class*="cl-form"]) {
    gap: 12px !important; /* Set gap to exactly 12px between all form elements */
  }

  /* Apply negative margin ONLY between consecutive input fields (email â†’ password) */
  /* This reduces the gap between email and password fields specifically */
  :global(.cl-formField:has(input[type="email"]) + .cl-formField:has(input[type="password"])),
  :global([data-clerk-element="formField"]:has(input[type="email"]) + [data-clerk-element="formField"]:has(input[type="password"])) {
    margin-top: -20px !important; /* Reduce gap from 12px to create tighter spacing between email and password */
  }

  /* When previous form field has an error, use less negative margin */
  :global(.cl-formField:has(.cl-formFieldError) + .cl-formField:has(input[type="password"])) {
    margin-top: -8px !important; /* Less negative to account for error message space */
  }

  /* Position error messages below input fields (not inside/overlapping) */
  :global(.cl-formFieldError),
  :global([data-clerk-element="formFieldError"]),
  :global(.cl-formFieldErrorText),
  :global([data-clerk-element="formFieldErrorText"]),
  :global([class*="formFieldError"]),
  :global(.cl-formFieldError span),
  :global(.cl-formFieldErrorText span),
  :global([class*="formFieldError"] span) {
    position: static !important;
    display: block !important;
    margin-top: 8px !important;
    margin-bottom: 16px !important;
    padding-top: 0 !important;
    padding-bottom: 0 !important;
    padding-left: 0 !important;
    padding-right: 0 !important;
    text-align: center !important;
    color: #ef4444 !important;
    font-size: 14px !important;
    line-height: 1.4 !important;
    width: 100% !important;
    left: auto !important;
    right: auto !important;
    top: auto !important;
    bottom: auto !important;
    transform: none !important;
  }

  /* Remove any absolute positioning from error icons */
  :global(.cl-formFieldError svg),
  :global(.cl-formFieldError [class*="icon"]),
  :global([class*="formFieldError"] svg),
  :global([class*="formFieldError"] [class*="icon"]) {
    position: static !important;
    display: inline-block !important;
    vertical-align: middle !important;
    margin-right: 4px !important;
  }

  /* Preserve footer and help text elements - don't apply negative margins to these */
  /* Keep footer padding-top but remove it from internal wrapper classes */
  :global(.cl-footer),
  :global([data-clerk-element="footer"]) {
    margin-top: 0 !important;
    margin-bottom: 0 !important;
    position: relative !important;
    z-index: 1 !important;
  }

  /* Remove padding-top from internal footer wrapper classes */
  :global([class*="cl-internal"][class*="footer"]),
  :global(.cl-footer [class*="cl-internal"]),
  :global([class*="cl-internal-vorlia"]) {
    padding-top: 0 !important;
  }

  /* Footer action links (like "Forgot password") */
  :global(.cl-footerActionLink),
  :global([data-clerk-element="footerActionLink"]) {
    margin-top: 0 !important;
    margin-bottom: 0 !important;
    position: relative !important;
    z-index: 1 !important;
  }

  /* Fix "Forgot password" link - ensure it appears BELOW password field, not above */
  /* Target all possible locations where Clerk might place the link */
  :global(.cl-formField:has(input[type="password"]) .cl-formFieldAction),
  :global(.cl-formField:has(input[type="password"]) [data-clerk-element="formFieldAction"]),
  :global(.cl-formField:has(input[type="password"]) [class*="formFieldAction"]),
  :global(.cl-formField:has(input[type="password"]) a[href*="forgot"]),
  :global(.cl-formField:has(input[type="password"]) a[href*="reset"]) {
    position: static !important;
    z-index: auto !important;
    display: block !important;
    margin-top: 8px !important;
    margin-bottom: 0 !important;
    text-align: center !important;
    order: 999 !important; /* High order value to ensure it appears last in flex layout */
    top: auto !important;
    bottom: auto !important;
    left: auto !important;
    right: auto !important;
    transform: none !important;
  }

  /* If forgot password link is a sibling after password field */
  :global(.cl-formField:has(input[type="password"]) ~ .cl-formFieldAction),
  :global(.cl-formField:has(input[type="password"]) + .cl-formFieldAction),
  :global(.cl-formField:has(input[type="password"]) ~ a[href*="forgot"]),
  :global(.cl-formField:has(input[type="password"]) ~ a[href*="reset"]) {
    position: static !important;
    margin-top: 8px !important;
    margin-bottom: 0 !important;
    text-align: center !important;
    top: auto !important;
    bottom: auto !important;
    transform: none !important;
  }

  /* Ensure password input appears before the link in flex order */
  :global(.cl-formField:has(input[type="password"]) input[type="password"]) {
    order: 1 !important;
  }

  /* Mesh gradient using all thread colors with subtle movement */
  .thread-colors-mesh-gradient {
    position: relative;
    overflow: hidden;
  }

  .thread-colors-mesh-gradient::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: 
      radial-gradient(circle at 20% 30%, var(--color-blue) 0%, transparent 50%),
      radial-gradient(circle at 80% 20%, var(--color-purple) 0%, transparent 50%),
      radial-gradient(circle at 40% 70%, var(--color-pink) 0%, transparent 50%),
      radial-gradient(circle at 60% 80%, var(--color-orange) 0%, transparent 50%),
      radial-gradient(circle at 10% 60%, var(--color-yellow) 0%, transparent 50%),
      radial-gradient(circle at 90% 50%, var(--color-green) 0%, transparent 50%);
    background-size: 100% 100%;
    animation: mesh-movement 8s ease-in-out infinite;
    opacity: 0.8;
  }

  .thread-colors-mesh-gradient::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
      radial-gradient(circle at 70% 40%, var(--color-pink) 0%, transparent 40%),
      radial-gradient(circle at 30% 90%, var(--color-yellow) 0%, transparent 40%),
      radial-gradient(circle at 50% 10%, var(--color-blue) 0%, transparent 40%),
      radial-gradient(circle at 15% 50%, var(--color-green) 0%, transparent 40%),
      radial-gradient(circle at 85% 70%, var(--color-purple) 0%, transparent 40%),
      radial-gradient(circle at 60% 30%, var(--color-orange) 0%, transparent 40%);
    background-size: 100% 100%;
    animation: mesh-movement-reverse 10s ease-in-out infinite;
    opacity: 0.6;
  }

  @keyframes mesh-movement {
    0%, 100% {
      transform: translate(0, 0) scale(1);
    }
    25% {
      transform: translate(5%, 3%) scale(1.05);
    }
    50% {
      transform: translate(-3%, 5%) scale(1.1);
    }
    75% {
      transform: translate(3%, -2%) scale(1.05);
    }
  }

  @keyframes mesh-movement-reverse {
    0%, 100% {
      transform: translate(0, 0) scale(1);
    }
    25% {
      transform: translate(-4%, -3%) scale(1.08);
    }
    50% {
      transform: translate(4%, -5%) scale(1.12);
    }
    75% {
      transform: translate(-2%, 3%) scale(1.06);
    }
  }

  /* Ensure SquareButton Back variant has proper shadow styling */
  :global(.square-button-container button[style*="background-image"]:not([data-outer-shadow])) {
    box-shadow: 0px -3px 0px 0px rgba(120, 118, 111, 0.2) inset !important;
  }

  :global(.square-button-container button[style*="background-image"]:not([data-outer-shadow]):active) {
    filter: brightness(0.97) !important;
    box-shadow: 
      0px -1px 0px 0px rgba(120, 118, 111, 0.2) inset,
      0px 1px 0px 0px rgba(120, 118, 111, 0.2) inset !important;
  }
</style>
