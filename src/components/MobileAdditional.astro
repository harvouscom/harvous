---
import SquareButton from "@/components/SquareButton.astro";
import { shouldShowMoreButton } from "@/utils/menu-options";

export interface Props {
  contentType?: "thread" | "note" | "space" | "dashboard" | "profile";
  contentId?: string;
  currentThread?: any;
  currentSpace?: any;
}

const { contentType = "dashboard", contentId, currentThread, currentSpace } = Astro.props;
const showMoreButton = shouldShowMoreButton(contentType);
---

<div 
  class="flex items-center justify-center gap-4"
  x-data="{}"
  x-init="
    // Listen for panel events and trigger mobile drawer
    window.addEventListener('openNewNotePanel', () => {
      console.log('MobileAdditional: openNewNotePanel received');
      // Dispatch event to open mobile drawer
      window.dispatchEvent(new CustomEvent('openMobileDrawer', { 
        detail: { type: 'note' } 
      }));
    });
    
    window.addEventListener('openNewThreadPanel', () => {
      console.log('MobileAdditional: openNewThreadPanel received');
      // Dispatch event to open mobile drawer
      window.dispatchEvent(new CustomEvent('openMobileDrawer', { 
        detail: { type: 'thread' } 
      }));
    });
    
    window.addEventListener('openNoteDetailsPanel', () => {
      // Dispatch event to open mobile drawer
      window.dispatchEvent(new CustomEvent('openMobileDrawer', { 
        detail: { type: 'noteDetails' } 
      }));
    });
    
    window.addEventListener('openProfilePanel', (event) => {
      console.log('MobileAdditional: openProfilePanel received', event.detail);
      const panelName = event.detail?.panelName;
      if (panelName === 'editNameColor') {
        // Dispatch event to open mobile drawer for edit name & color
        window.dispatchEvent(new CustomEvent('openMobileDrawer', { 
          detail: { type: 'editNameColor' } 
        }));
      } else if (panelName === 'getSupport') {
        // Dispatch event to open mobile drawer for get support
        window.dispatchEvent(new CustomEvent('openMobileDrawer', { 
          detail: { type: 'getSupport' } 
        }));
      }
    });
  "
>
  <!-- Default state: SquareButtons in horizontal layout -->
  <div class={`w-full flex ${showMoreButton ? 'justify-between' : 'justify-end'}`}>
    {showMoreButton && (
      <SquareButton variant="More" withMenu={true} contentType={contentType} contentId={contentId} />
    )}
    {contentType !== 'profile' && (
      <SquareButton variant="Add" withMenu={true} />
    )}
  </div>
</div>
