---
import SearchInput from "@/components/SearchInput.astro";
import SpaceButton from "@/components/SpaceButton.astro";
import Avatar from "@/components/Avatar.astro";

export interface Props {
  spaces?: any[];
  threads?: any[];
  inboxCount?: number;
  currentSpace?: any;
  currentThread?: any;
}

const { 
  spaces = [], 
  threads = [], 
  inboxCount = 0,
  currentSpace,
  currentThread
} = Astro.props;
---

<div class="grid grid-cols-[auto_1fr_auto] items-center gap-3 w-full">
  <!-- Search Icon Button (Column 1: auto) -->
  <button class="flex items-center justify-center h-[60px] w-[60px] rounded-[24px] bg-white shadow-[0px_-2.622px_0px_0px_inset_rgba(176,176,176,0.25)]">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
    </svg>
  </button>

  <!-- Spaces Dropdown (Column 2: 1fr) -->
  <div class="relative" x-data="{ open: false }">
    <SpaceButton 
      text="For You" 
      count={inboxCount}
      state="DropdownTrigger"
      className="w-full"
      @click="open = !open"
    />
    
    <!-- Dropdown Menu -->
    <div 
      x-show="open" 
      @click.away="open = false"
      x-transition:enter="transition ease-out duration-200"
      x-transition:enter-start="opacity-0 scale-95"
      x-transition:enter-end="opacity-100 scale-100"
      x-transition:leave="transition ease-in duration-150"
      x-transition:leave-start="opacity-100 scale-100"
      x-transition:leave-end="opacity-0 scale-95"
      class="absolute top-full left-0 mt-2 w-64 bg-white rounded-lg shadow-lg border border-gray-200 z-50"
    >
      <div class="p-2">
        <!-- For You -->
        <a href="/dashboard" class="block w-full">
          <div class="flex items-center justify-between p-2 rounded hover:bg-gray-50">
            <span class="text-sm font-medium">For You</span>
            <span class="text-xs text-gray-500">{inboxCount}</span>
          </div>
        </a>
        
        <!-- Spaces -->
        {spaces.map(space => (
          <a href={`/${space.id}`} class="block w-full">
            <div class="flex items-center justify-between p-2 rounded hover:bg-gray-50">
              <span class="text-sm font-medium">{space.title}</span>
              <span class="text-xs text-gray-500">{space.totalItemCount}</span>
            </div>
          </a>
        ))}
        
        <!-- Pinned Threads -->
        {threads.filter(thread => thread.isPinned).map(thread => (
          <a href={`/${thread.id}`} class="block w-full">
            <div class="flex items-center justify-between p-2 rounded hover:bg-gray-50">
              <span class="text-sm font-medium">{thread.title}</span>
              <span class="text-xs text-gray-500">{thread.noteCount}</span>
            </div>
          </a>
        ))}
      </div>
    </div>
  </div>

  <!-- Avatar (Column 3: auto) -->
  <Avatar initials="DJ" />
</div>
