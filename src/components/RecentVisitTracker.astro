---
interface Props {
  type: 'note' | 'thread';
  id: number | string;
  title: string;
}

const { type, id, title } = Astro.props;
---

<!-- Empty component, functionality is client-side only -->

<script define:vars={{ type, id, title }}>
// Make typescript happy
declare global {
  interface Window {
    addToRecentlyVisited?: (type: string, id: string | number, title: string) => void;
  }
}

document.addEventListener('DOMContentLoaded', () => {
  // Initialize the addToRecentlyVisited function if it doesn't exist
  if (!window.addToRecentlyVisited) {
    window.addToRecentlyVisited = function(type, id, title) {
      let recentlyVisited = JSON.parse(localStorage.getItem('recentlyVisited') || '[]');
      
      // Generate the URL based on type and id
      const url = type === 'note' ? `/feed/notes/${id}` : `/feed/threads/${id}`;
      
      // Check if this item already exists in the array
      const existingIndex = recentlyVisited.findIndex(item => 
        item.type === type && item.id === id
      );
      
      // If it exists, remove it so we can add it to the top
      if (existingIndex !== -1) {
        recentlyVisited.splice(existingIndex, 1);
      }
      
      // Add the item to the beginning of the array
      recentlyVisited.unshift({
        type,
        id,
        title,
        url,
        timestamp: Date.now()
      });
      
      // Limit to 10 items
      if (recentlyVisited.length > 10) {
        recentlyVisited = recentlyVisited.slice(0, 10);
      }
      
      // Save back to localStorage
      localStorage.setItem('recentlyVisited', JSON.stringify(recentlyVisited));
    };
  }
  
  // Add the current page to recently visited
  if (window.addToRecentlyVisited) {
    window.addToRecentlyVisited(type, id, title);
  }
});
</script> 