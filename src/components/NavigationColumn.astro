---
import SpaceButton from "@/components/SpaceButton.astro";
import SquareButton from "@/components/SquareButton.astro";
import Avatar from "@/components/Avatar.astro";
import PersistentNavigation from "@/components/PersistentNavigation.astro";

interface Props {
  inboxCount?: number;
  spaces?: Array<{
    id: string;
    title: string;
    totalItemCount: number;
    backgroundGradient: string;
  }>;
  activeThread?: {
    id: string;
    title: string;
    noteCount: number;
    backgroundGradient: string;
  } | null;
  currentSpace?: {
    id: string;
  } | null;
  isNote?: boolean;
  currentId?: string;
}

const { 
  inboxCount = 0,
  spaces = [],
  activeThread = null,
  currentSpace = null,
  isNote = false,
  currentId = null
} = Astro.props;
---

<!-- Navigation Column -->
<div slot="navigation" class="h-full">
  <div class="flex flex-col items-start justify-between relative h-full">
    <!-- Top Section - Navigation -->
    <div class="flex flex-col gap-12 items-start justify-start w-full flex-1 min-h-0">
      <!-- Navigation Buttons -->
      <div class="flex flex-col items-start justify-start w-full">
        <a href="/dashboard" class="w-full">
          <SpaceButton 
            text="For You" 
            count={inboxCount} 
            state="WithCount" 
            className="w-full" 
            isActive={false} 
          />
        </a>
        
        {/* Persistent Navigation - shows recently accessed items */}
        <PersistentNavigation />
        
        {/* Show created spaces */}
        {spaces.map(space => (
          <div data-navigation-item={space.id} class="w-full">
            <a href={`/${space.id}`} class="w-full">
              <SpaceButton 
                text={space.title} 
                count={space.totalItemCount} 
                state="Close" 
                className="w-full" 
                backgroundGradient={space.backgroundGradient}
                isActive={currentSpace?.id === space.id}
                itemId={space.id}
              />
            </a>
          </div>
        ))}
        
        {/* Show active thread if any */}
        {activeThread ? (
          <a href={`/${activeThread.id}`} class="w-full">
            <SpaceButton 
              text={activeThread.title} 
              count={activeThread.noteCount} 
              state="Close" 
              className="w-full" 
              backgroundGradient={activeThread.backgroundGradient}
              isActive={isNote || activeThread.id === currentId}
              itemId={activeThread.id}
            />
          </a>
        ) : null}
      </div>
    </div>
    
    <!-- Bottom Section with New Space Button, Search, and Avatar -->
    <div class="flex gap-3 items-center justify-start w-full shrink-0">
      <SpaceButton text="New Space" className="flex-1" />
      <SquareButton variant="Search" />
      <Avatar initials="DJ" />
    </div>
  </div>
</div>
